### åº•å±‚é€šä¿¡æŠ€æœ¯ï¼ˆå¦‚ä½•å‘é€è¯·æ±‚ï¼‰

- **XMLHttpRequest (XHR)** - è¾ƒæ—©çš„ AJAX å®ç°æ–¹å¼
- **Fetch API** - ç°ä»£çš„ AJAX å®ç°æ–¹å¼

### å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼ˆå¦‚ä½•å¤„ç†å¼‚æ­¥ç»“æœï¼‰

- **å›è°ƒå‡½æ•° (Callbacks)** - ä¼ ç»Ÿæ–¹å¼
- **Promise** - ç°ä»£æ–¹å¼
- **Async/Await** - åŸºäº Promise çš„è¯­æ³•ç³–

### AJAX

#### XHR

ä½¿ç”¨ XMLHttpRequest å¯¹è±¡ï¼ˆç°ä»£å¼€å‘ä¸­å¤šç”¨ fetch æ›¿ä»£ï¼‰ã€‚

ä¼ ç»Ÿçš„å¼‚æ­¥è¯·æ±‚æ–¹å¼ï¼Œå›è°ƒåµŒå¥—è¾ƒæ·±

```js
const xhr = new XMLHttpRequest();
xhr.open("GET", "https://jsonplaceholder.typicode.com/posts/1", true);
xhr.onreadystatechange = function () {
    if (xhr.readyState === 4 && xhr.status === 200) {
        console.log(JSON.parse(xhr.responseText));
    }
};
xhr.send();
```

å¤æ‚ç‰ˆ

```js
// åˆ›å»º XMLHttpRequest å¯¹è±¡
const xhr = new XMLHttpRequest();

// é…ç½®è¯·æ±‚
xhr.open('GET', 'https://api.example.com/data', true);

// è®¾ç½®å“åº”ç±»å‹
xhr.responseType = 'json';

// è®¾ç½®è¯·æ±‚å¤´ï¼ˆå¦‚éœ€è¦ï¼‰
xhr.setRequestHeader('Content-Type', 'application/json');

// ç›‘å¬çŠ¶æ€å˜åŒ–
xhr.onreadystatechange = function() {
  if (xhr.readyState === 4) {  // è¯·æ±‚å®Œæˆ
    if (xhr.status === 200) {  // è¯·æ±‚æˆåŠŸ
      console.log('æ•°æ®è·å–æˆåŠŸ:', xhr.response);
      // å¤„ç†è¿”å›çš„æ•°æ®
      document.getElementById('result').textContent = JSON.stringify(xhr.response);
    } else {
      console.error('è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :', xhr.status);
    }
  }
};

// ç›‘å¬åŠ è½½å®Œæˆäº‹ä»¶ï¼ˆæ›¿ä»£ onreadystatechange çš„ç°ä»£æ–¹å¼ï¼‰
xhr.onload = function() {
  if (xhr.status === 200) {
    console.log('æ•°æ®åŠ è½½æˆåŠŸ:', xhr.response);
  }
};

// ç›‘å¬é”™è¯¯
xhr.onerror = function() {
  console.error('è¯·æ±‚å‘ç”Ÿé”™è¯¯');
};

// å‘é€è¯·æ±‚
xhr.send();

// å¦‚æœæ˜¯ POST è¯·æ±‚ï¼Œå¯ä»¥å‘é€æ•°æ®
// xhr.send(JSON.stringify({ name: 'John', age: 30 }));

```

#### fetch

```js
fetch('https://api.example.com/data')
  .then(response => {
    if (!response.ok) {
      throw new Error('ç½‘ç»œå“åº”ä¸æ­£å¸¸');
    }
    return response.json();
  })
  .then(data => {
    console.log('è·å–çš„æ•°æ®:', data);
    document.getElementById('result').textContent = JSON.stringify(data);
  })
  .catch(error => {
    console.error('è·å–æ•°æ®å‡ºé”™:', error);
  });

// POST è¯·æ±‚ç¤ºä¾‹
fetch('https://api.example.com/post', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({ name: 'John', age: 30 })
})
  .then(response => response.json())
  .then(data => console.log('æäº¤æˆåŠŸ:', data))
  .catch(error => console.error('æäº¤å¤±è´¥:', error));

```

#### Axios

Axios æ˜¯ä¸€ä¸ªåŸºäº Promise çš„ HTTP å®¢æˆ·ç«¯ï¼Œæ”¯æŒæµè§ˆå™¨å’Œ Node.jsï¼Œç®€åŒ–äº† XMLHttpRequest å’Œ fetch çš„ä½¿ç”¨ã€‚

**åŸºäº Promise å°è£…çš„ HTTP å®¢æˆ·ç«¯**ï¼Œç›¸æ¯” fetch æ›´æ–¹ä¾¿

é»˜è®¤ JSON è§£æï¼ˆfetch éœ€è¦æ‰‹åŠ¨ .json()ï¼‰ã€‚æä¾›è¯·æ±‚/å“åº”æ‹¦æˆªå™¨ã€è‡ªåŠ¨å–æ¶ˆè¯·æ±‚ã€è¶…æ—¶æ§åˆ¶ç­‰é«˜çº§åŠŸèƒ½ã€‚

**åº•å±‚ç”¨ XMLHttpRequestï¼ˆåœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼‰æˆ–è€… http æ¨¡å—ï¼ˆåœ¨ Node.js ä¸­ï¼‰**ã€‚

```js
// GET è¯·æ±‚
axios.get('https://api.example.com/data')
  .then(response => {
    console.log('æ•°æ®è·å–æˆåŠŸ:', response.data);
    document.getElementById('result').textContent = JSON.stringify(response.data);
  })
  .catch(error => {
    console.error('è¯·æ±‚å¤±è´¥:', error);
  });

// POST è¯·æ±‚
axios.post('https://api.example.com/post', {
  name: 'John',
  age: 30
})
  .then(response => {
    console.log('æäº¤æˆåŠŸ:', response.data);
  })
  .catch(error => {
    console.error('æäº¤å¤±è´¥:', error);
  });

```



### å¼‚æ­¥å¤„ç†æ¨¡å¼ï¼ˆå¦‚ä½•å¤„ç†å¼‚æ­¥ç»“æœï¼‰

#### **å›è°ƒå‡½æ•° (Callbacks)** - ä¼ ç»Ÿæ–¹å¼

#### Promise

**Promise æ˜¯ JavaScript æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆ**ï¼Œç”¨äºé¿å…å›è°ƒåœ°ç‹±ï¼ˆcallback hellï¼‰ã€‚å®ƒæœ€æ—©æ˜¯ä¸ºäº†è§£å†³ XMLHttpRequestï¼ˆAJAXï¼‰ä¸­å¤æ‚çš„å›è°ƒåµŒå¥—é—®é¢˜ã€‚

fetch è¿”å›çš„æ˜¯ Promiseï¼Œæ‰€ä»¥ fetch æœ¬è´¨ä¸Šæ˜¯ XMLHttpRequest + Promiseã€‚

new Promise((resolve, reject) => {...}) **åˆ›å»ºä¸€ä¸ªæ–°çš„ Promise å¯¹è±¡**ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ª**æ‰§è¡Œå™¨å‡½æ•°** (resolve, reject) => {...} ä½œä¸ºå‚æ•°ã€‚

Promise çš„ resolve å’Œ reject æœ¬è´¨ä¸Šæ˜¯ **å›è°ƒå‡½æ•°**ï¼Œå®ƒä»¬çš„ä½œç”¨æ˜¯ **æ”¹å˜ Promise çš„çŠ¶æ€**ï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™ .then() æˆ– .catch()ã€‚

- **resolve(value)**ï¼šä½¿ Promise å˜ä¸º **fulfilledï¼ˆå·²å®Œæˆï¼‰** çŠ¶æ€ï¼Œå¹¶è¿”å› value
- **reject(reason)**ï¼šä½¿ Promise å˜ä¸º **rejectedï¼ˆå·²æ‹’ç»ï¼‰** çŠ¶æ€ï¼Œå¹¶è¿”å› reasonã€‚

```js
function fetchData() {
    return new Promise((resolve, reject) => {
        console.log("Fetching data...");
        
        setTimeout(() => {
            const success = Math.random() > 0.2; // 80% æˆåŠŸï¼Œ20% å¤±è´¥

            if (success) {
                resolve({ id: 1, name: "John Doe", age: 30 });
            } else {
                reject("Failed to fetch data!");
            }
        }, 2000);
    });
}

// ä½¿ç”¨ Promise å¤„ç†æ•°æ®
fetchData()
    .then(data => {
        console.log("âœ… Data received:", data);
    })
    .catch(error => {
        console.error("âŒ Error:", error);
    })
    .finally(() => {
        console.log("ğŸ¯ Request completed.");
    });
```



##### æ‰‹å†™å®ç°Promise

```js
class MyPromise{
  constructor(executor){
    this.state = 'pending'; // 'pending', 'fulfilled', 'rejected'
    this.value = undefined; // å­˜å‚¨æœ€ç»ˆçš„å€¼
    this.reason = undefined; // å­˜å‚¨æ‹’ç»çš„åŸå› 
    this.onFullfilledCallbacks = []; // å­˜å‚¨æˆåŠŸçš„å›è°ƒ
    this.onRejectedCallbacks = []; // å­˜å‚¨å¤±è´¥çš„å›è°ƒ
  
    const resolve = (value) => {
      if(this.state === 'pending'){
        this.state = 'fulfilled';
        this.value = value;
        this.onFullfilledCallbacks.forEach(fn => fn(value))
      }
    }

    const reject = (reason) => {
      if(this.state === 'pending'){
        this.state = 'rejected';
        this.value = reason;
        this.onRejectedCallbacks.foEach(fn => fn(reason))
      }
    }
  
    // æ‰§è¡Œä¼ å…¥çš„ executor å‡½æ•°ï¼ˆæ‰§è¡Œå™¨å‡½æ•°ï¼‰
    // åœ¨æ‰§è¡Œ executor æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šæ”¾å…¥å¼‚æ­¥æ“ä½œï¼Œæ¯”å¦‚ç½‘ç»œè¯·æ±‚ã€å®šæ—¶å™¨ç­‰ã€‚
    try{
      executor(resolve, reject);
    } catch(e){
      reject(e);
    }
  }
  
  then(onFulfilled, onRejected) {
    return new MyPromise((resolve, reject) => {
      if (this.state === "fulfilled") {
        // è®°å¾—resolveè¿˜è¦åŒ…ä¸€å±‚onfulfilled ä¸èƒ½è·³è¿‡onFulfilled å›è°ƒ
        setTimeout(() => resolve(onFulfilled(this.value)), 0);
      } else if (this.state === "rejected") {
        setTimeout(() => reject(onRejected(this.reason)), 0);
      } else {
        this.onFulfilledCallbacks.push(value => {
          resolve(onFulfilled(value));
        });
        this.onRejectedCallbacks.push(reason => {
          reject(onRejected(reason));
        });
      }
    });
  }
}
```

æ¯æ¬¡ .then **éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ Promise**ï¼Œè¿™æ ·æ‰èƒ½è®©ä¸‹ä¸€ä¸ª .then ç»§ç»­å¤„ç†å‰ä¸€ä¸ª .then çš„è¿”å›å€¼ã€‚

å› ä¸º**Promise è§„èŒƒè¦æ±‚ then é‡Œçš„å›è°ƒå¿…é¡»æ˜¯å¼‚æ­¥æ‰§è¡Œçš„**ï¼Œå³**å¿…é¡»ç­‰ä¸»çº¿ç¨‹çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œ**ï¼Œå†æ‰§è¡Œ .then é‡Œçš„å›è°ƒã€‚

å¦‚æœ Promise é‡Œçš„å›è°ƒ **ç«‹å³æ‰§è¡Œ**ï¼Œå¯èƒ½ä¼šæ‰“ä¹±ä¸»çº¿ç¨‹çš„ä»£ç æ‰§è¡Œé¡ºåºï¼Œå¯¼è‡´**ä¸å¯é¢„æµ‹çš„è¡Œä¸º**ã€‚

åŸç”Ÿ Promise ä¸æ˜¯ç”¨ setTimeoutï¼Œè€Œæ˜¯**ä½¿ç”¨å¾®ä»»åŠ¡é˜Ÿåˆ—**ï¼š

```js
queueMicrotask(() => resolve(onFulfilled(this.value)));
```

æˆ–è€…ç”¨ MutationObserver å®ç°å¾®ä»»åŠ¡ï¼š

```js
const microTask = (callback) => {
  const observer = new MutationObserver(callback);
  const textNode = document.createTextNode("0");
  observer.observe(textNode, { characterData: true });
  textNode.data = "1"; // è§¦å‘å¾®ä»»åŠ¡
};

then(onFulfilled, onRejected) {
  return new MyPromise((resolve, reject) => {
    if (this.state === "fulfilled") {
      microTask(() => resolve(onFulfilled(this.value)));
    } else if (this.state === "rejected") {
      microTask(() => reject(onRejected(this.reason)));
    }
  });
}
```



**å®ç°Promise.resolve**

```js
Promise.resolve = (param) => {
  if(param instanceof Promise){
    return param;
  }
  return new Promise((resolve, reject)=> {
    if(param && param.then && typeof param.then === 'function'){
      // å¦‚æœ param æ˜¯ Thenableï¼Œè°ƒç”¨å®ƒçš„ then æ–¹æ³•
      params.then(resolve, reject);
    } else {
      // è®©æ–°åˆ›å»ºçš„ Promise ç›´æ¥è¿›å…¥ fulfilled çŠ¶æ€ï¼Œå¹¶æºå¸¦ param ä½œä¸ºç»“æœã€‚
      resolve(param);
    }
  } )
}
```

**å®ç°Promise.reject**

```js
Promise.reject((reson)=>{
  return new Promise((resolve, reject) => {
    reject(reason)
  })
})
```

1. Promise.all(iterable)
   - æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡(å¦‚æ•°ç»„)ä½œä¸ºå‚æ•°
   - å½“æ‰€æœ‰ Promise éƒ½ fulfilled æ—¶,è¿”å›ä¸€ä¸ªæ–°çš„ Promise,å€¼ä¸ºæ‰€æœ‰ Promise çš„ç»“æœæ•°ç»„
   - å¦‚æœä»»ä½•ä¸€ä¸ª Promise è¢« rejected,åˆ™æ•´ä¸ª Promise.all ä¼šç«‹å³ rejected,å€¼ä¸ºç¬¬ä¸€ä¸ªè¢« rejected çš„ Promise çš„å€¼
2. Promise.any(iterable)
   - æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡(å¦‚æ•°ç»„)ä½œä¸ºå‚æ•°
   - å½“ä»»æ„ä¸€ä¸ª Promise è¢« fulfrailled æ—¶,è¿”å›ä¸€ä¸ªæ–°çš„ Promise,å€¼ä¸ºç¬¬ä¸€ä¸ªè¢« fulfilled çš„ Promise çš„å€¼
   - å¦‚æœæ‰€æœ‰ Promise éƒ½è¢« rejected,åˆ™æ•´ä¸ª Promise.any ä¼š rejected,å€¼ä¸º AggregateError å®ä¾‹
3. Promise.race(iterable)
   - æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡(å¦‚æ•°ç»„)ä½œä¸ºå‚æ•°
   - å½“ä»»æ„ä¸€ä¸ª Promise è¢« settled(fulfilled æˆ– rejected)æ—¶,è¿”å›ä¸€ä¸ªæ–°çš„ Promise,å€¼ä¸ºç¬¬ä¸€ä¸ªè¢« settled çš„ Promise çš„å€¼
4. Promise.allSettled(iterable)
   - æ¥å—ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡(å¦‚æ•°ç»„)ä½œä¸ºå‚æ•°
   - å½“æ‰€æœ‰ Promise éƒ½ settled(fulfilled æˆ– rejected)æ—¶,è¿”å›ä¸€ä¸ªæ–°çš„ Promise,å€¼ä¸ºæ‰€æœ‰ Promise çš„ç»“æœæ•°ç»„,æ¯ä¸ªç»“æœéƒ½åŒ…å« status å’Œ value/reason



**å®ç°Promise.prototype.race**

```js
Promise.prototype.race = function(promises) {
    return new Promise((resolve, reject) => {
        if (!Array.isArray(promises)) {
            throw new TypeError('Promise.race expects an array');
        }

      const promisesArray = Array.from(promises);

      // å¦‚æœä¼ å…¥çš„æ˜¯ç©ºæ•°ç»„ï¼Œåˆ™ race ä¼šæ°¸è¿œå¤„äº pending çŠ¶æ€
      if (promisesArray.length === 0) {
        return; // æ°¸è¿œå¤„äº pending çŠ¶æ€
      }

      // éå†æ‰€æœ‰ Promise
      promisesArray.forEach(promise => {
        // ä½¿ç”¨ Promise.resolve ç¡®ä¿è¾“å…¥é¡¹æ˜¯ Promise
        Promise.resolve(promise).then(resolve, reject);
      });
    });
};
```

**å®ç°Promise.prototype.finally**

**finally æ˜¯å®ä¾‹æ–¹æ³•**ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨å·²å­˜åœ¨çš„ Promise å®ä¾‹ä¸Šæ‰§è¡Œçš„ï¼Œç”¨æ¥å¤„ç†å®Œæˆæ—¶çš„å‰¯ä½œç”¨ï¼Œå¹¶ä¸”ä¸æ”¹å˜åŸ Promise çš„æœ€ç»ˆç»“æœã€‚

åœ¨ JavaScript ä¸­ï¼ŒPromise ç±»ä½¿ç”¨äº†é™æ€æ–¹æ³•ï¼ˆä¾‹å¦‚ Promise.resolve()ã€Promise.reject() å’Œ Promise.all()ï¼‰æ¥åˆ›å»ºæ–°çš„ Promise å®ä¾‹ï¼Œè€Œ finally åˆ™æ˜¯ä½œä¸ºå®ä¾‹æ–¹æ³•æ”¾åœ¨åŸå‹ä¸Šï¼Œå› ä¸ºå®ƒä½œç”¨äºå·²ç»å­˜åœ¨çš„ Promise å®ä¾‹ï¼Œç”¨æ¥åœ¨ Promise å®Œæˆæ—¶æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨ã€‚


- `finally`é‡Œçš„å›è°ƒå‡½æ•°ï¼Œæ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œï¼Œå¹¶ä¼šæŠŠå‰é¢çš„å€¼åŸå°ä¸åŠ¨ä¼ é€’ç»™ä¸‹ä¸€ä¸ª`then`æ–¹æ³•ä¸­
- å¦‚æœ`finally`å‡½æ•°ä¸­æœ‰`promise`ç­‰å¼‚æ­¥ä»»åŠ¡ï¼Œä¼šç­‰å®ƒä»¬å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå†ç»“åˆä¹‹å‰çš„æˆåŠŸä¸å¦çŠ¶æ€ï¼Œè¿”å›å€¼

```js
Promise.prototype.finally = function(callback) {
  return this.then(
    (data) => {
      return Promise.resolve(callback()).then(() => data); // ä¿ç•™åŸå§‹ Promise çš„æˆåŠŸå€¼
    },
    (err) => {
      return Promise.resolve(callback()).then(() => {
        throw err; // ä¿ç•™åŸå§‹ Promise çš„å¤±è´¥é”™è¯¯
      });
    }
  );
}
```

**å®ç°Promise.all**

- ä¼ å…¥å‚æ•°ä¸ºä¸€ä¸ªç©ºçš„å¯è¿­ä»£å¯¹è±¡ï¼Œåˆ™ç›´æ¥è¿›è¡Œ`resolve`ã€‚
- å¦‚æœå‚æ•°ä¸­æœ‰ä¸€ä¸ª`promise`å¤±è´¥ï¼Œé‚£ä¹ˆ`Promise.all`è¿”å›çš„`promise`å¯¹è±¡å¤±è´¥ã€‚
- åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œ`Promise.all` è¿”å›çš„ `promise` çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„

```js
Promise.prototype.all = function(promises) {
    return new Promise((resolve, reject) => {
        if (!Array.isArray(promises)) {
            throw new TypeError('Promise.all expects an array');
        }

        const results = [];
        let completed = 0;

        for (let i = 0; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(value => {
                results[i] = value; // ä¿å­˜ç»“æœ
                completed += 1; // å®Œæˆè®¡æ•°

                if (completed === promises.length) {
                    resolve(results); // æ‰€æœ‰ Promise æˆåŠŸ
                }
            }).catch(reject); // ä»»ä½•ä¸€ä¸ª Promise å¤±è´¥åˆ™æ‹’ç»
        }
    });
};

```

**`Promise.prototype.any` å®ç°**

è¯¥ Promise åœ¨ä»»æ„ä¸€ä¸ªè¾“å…¥çš„ Promise æˆåŠŸæ—¶è§£æï¼Œæˆ–åœ¨æ‰€æœ‰ Promise æ‹’ç»æ—¶æ‹’ç»ã€‚

```js
Promise.prototype.any = function(promises) {
    return new Promise((resolve, reject) => {
        if (!Array.isArray(promises)) {
            throw new TypeError('Promise.any expects an array');
        }

        const errors = [];
        let count = 0;

        for (const promise of promises) {
            Promise.resolve(promise).then(resolve).catch(error => {
                errors.push(error);
                count += 1;

                if (count === promises.length) {
                    reject(new AggregateError(errors, 'All promises were rejected')); // æ‰€æœ‰ Promise æ‹’ç»
                }
            });
        }
    });
};

```

**`Promise.prototype.allSettled` å®ç°**

```js
Promise.prototype.allSettled = function(promises) {
    return new Promise((resolve) => {
        if (!Array.isArray(promises)) {
            throw new TypeError('Promise.allSettled expects an array');
        }

        const results = [];
        let completed = 0;

        for (let i = 0; i < promises.length; i++) {
            Promise.resolve(promises[i]).then(value => {
                results[i] = { status: 'fulfilled', value }; // æˆåŠŸçš„ç»“æœ
            }).catch(reason => {
                results[i] = { status: 'rejected', reason }; // å¤±è´¥çš„ç»“æœ
            }).finally(() => {
                completed += 1;
                if (completed === promises.length) {
                    resolve(results); // æ‰€æœ‰ Promise å®Œæˆ
                }
            });
        }
    });
};

```



#### **async/await**

async/await æ˜¯ ES2017 å¼•å…¥çš„ä¸€ç§åŸºäº Promise çš„è¯­æ³•ç³–ï¼Œä½¿å¼‚æ­¥ä»£ç æ›´ç›´è§‚ï¼ŒåƒåŒæ­¥ä»£ç ä¸€æ ·ä¹¦å†™ã€‚

- async/await æœ¬è´¨ä¸Šæ˜¯ Promise çš„è¯­æ³•ç³–ï¼Œè®©å¼‚æ­¥ä»£ç åƒåŒæ­¥ä»£ç ä¸€æ ·å†™ã€‚
- await ç”¨äºç­‰å¾… Promise è§£æï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ .then()ã€‚

```js
async function fetchData() {
    try {
        let response = await fetch("https://jsonplaceholder.typicode.com/posts/1");
        let data = await response.json();
        console.log(data);
    } catch (error) {
        console.error("Error fetching data:", error);
    }
}
fetchData();
```



### é˜²æŠ–

```js
// funcæ˜¯ç”¨æˆ·ä¼ å…¥éœ€è¦é˜²æŠ–çš„å‡½æ•°
// waitæ˜¯ç­‰å¾…æ—¶é—´
const debounce = (func, wait = 50) => {
  // ç¼“å­˜ä¸€ä¸ªå®šæ—¶å™¨id
  let timer = 0
  // è¿™é‡Œè¿”å›çš„å‡½æ•°æ˜¯æ¯æ¬¡ç”¨æˆ·å®é™…è°ƒç”¨çš„é˜²æŠ–å‡½æ•°
  // å¦‚æœå·²ç»è®¾å®šè¿‡å®šæ—¶å™¨äº†å°±æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨
  // å¼€å§‹ä¸€ä¸ªæ–°çš„å®šæ—¶å™¨ï¼Œå»¶è¿Ÿæ‰§è¡Œç”¨æˆ·ä¼ å…¥çš„æ–¹æ³•
  return function(...args) {
    if (timer) clearTimeout(timer)
    timer = setTimeout(() => {
      func.apply(this, args)
    }, wait)
  }
}

```

### èŠ‚æµ

```js
function throttle(func, limit) {
    let lastFunc; // å­˜å‚¨ä¸Šä¸€æ¬¡æ‰§è¡Œçš„å‡½æ•°
    let lastRan;  // å­˜å‚¨ä¸Šä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´

    return function(...args) {
        const context = this; // ä¿å­˜å½“å‰ä¸Šä¸‹æ–‡

        // å¦‚æœæ²¡æœ‰ä¸Šä¸€æ¬¡æ‰§è¡Œï¼Œæˆ–è€…è·ç¦»ä¸Šä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´è¶…è¿‡äº†é™åˆ¶
        if (!lastRan || (Date.now() - lastRan) >= limit) {
            func.apply(context, args); // æ‰§è¡Œå‡½æ•°
            lastRan = Date.now(); // æ›´æ–°ä¸Šä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´
        } else {
            // å¦‚æœåœ¨é™åˆ¶æ—¶é—´å†…è°ƒç”¨ï¼Œåˆ™è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨
            clearTimeout(lastFunc); // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            lastFunc = setTimeout(() => {
                func.apply(context, args); // æ‰§è¡Œå‡½æ•°
                lastRan = Date.now(); // æ›´æ–°ä¸Šä¸€æ¬¡æ‰§è¡Œçš„æ—¶é—´
            }, limit - (Date.now() - lastRan));
        }
    };
}
```



### æ‰‹å†™new

```js
function myNew(constructor, ...args) {
  // 1. åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºå¯¹è±¡
  const obj = {};
  
  // 2. å°†å¯¹è±¡çš„åŸå‹é“¾æ¥åˆ°æ„é€ å‡½æ•°çš„prototype
  Object.setPrototypeOf(obj, constructor.prototype);
  
  // ä¹Ÿå¯ä»¥å†™æˆ: obj.__proto__ = constructor.prototype;
  
  // 3. å°†æ„é€ å‡½æ•°çš„thisç»‘å®šåˆ°æ–°åˆ›å»ºçš„å¯¹è±¡, å¹¶æ‰§è¡Œæ„é€ å‡½æ•°
  const result = constructor.apply(obj, args);
  
  // 4. å¦‚æœæ„é€ å‡½æ•°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡, åˆ™è¿”å›è¯¥å¯¹è±¡; å¦åˆ™è¿”å›æ–°åˆ›å»ºçš„å¯¹è±¡
  return (typeof result === 'object' && result !== null) ? result : obj;
}
```

```js
// ä¸è¿”å›ä»»ä½•å€¼çš„æ„é€ å‡½æ•°
function Car(make) {
  this.make = make;
  // æ²¡æœ‰returnè¯­å¥
}

const car = new Car('Toyota');
console.log(car); // Car {make: 'Toyota'}

// è¿”å›åŸå§‹å€¼çš„æ„é€ å‡½æ•°
function Bike(brand) {
  this.brand = brand;
  return 'A bike';  // è¿”å›å­—ç¬¦ä¸²ï¼Œä¼šè¢«å¿½ç•¥
}

const bike = new Bike('Giant');
console.log(bike); // Bike {brand: 'Giant'} - è¿”å›å€¼è¢«å¿½ç•¥

// è¿”å›å¯¹è±¡çš„æ„é€ å‡½æ•°
function Computer(cpu) {
  this.cpu = cpu;
  return { type: 'laptop', brand: 'Dell' }; // è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡
}

const computer = new Computer('Intel');
console.log(computer); // {type: 'laptop', brand: 'Dell'} - ä½¿ç”¨è¿”å›çš„å¯¹è±¡
console.log(computer.cpu); // undefined - åŸå§‹thiså¯¹è±¡è¢«ä¸¢å¼ƒ
```

æµ‹è¯•ä»£ç 

```js
function Person(name, age) {
    this.name = name;
    this.age = age;
}

const person1 = myNew(Person, "Alice", 25);
console.log(person1.name); // Alice
console.log(person1.age);  // 25
console.log(person1 instanceof Person); // true
```



### æ‰‹å†™call && apply && bind

**call**

```js
Function.prototype.myCall = function (context, ...args) {
  if (typeof this !== "function") {
    throw new TypeError("Not a function");
  }
  
  context = context || globalThis; // `null` å’Œ `undefined` æŒ‡å‘ `window` æˆ– `globalThis`
  const fnKey = Symbol(); // ç”¨ Symbol é¿å…å±æ€§å†²çª
  context[fnKey] = this; // `this` æŒ‡å‘è°ƒç”¨ `myCall` çš„å‡½æ•°
  
  const result = context[fnKey](...args); // æ‰§è¡Œå‡½æ•°
  delete context[fnKey]; // åˆ é™¤ä¸´æ—¶å±æ€§ï¼Œé˜²æ­¢æ±¡æŸ“

  return result;
};

// âœ… æµ‹è¯• `myCall`
function greet(greeting, punctuation) {
  console.log(`${greeting}, ${this.name}${punctuation}`);
}

const person = { name: "Alice" };

greet.myCall(person, "Hello", "!"); // Hello, Alice!
```

**apply**

```js
Function.prototype.myApply = function (context, argsArray) {
  if (typeof this !== "function") {
    throw new TypeError("Not a function");
  }

  context = context || globalThis;
  const fnKey = Symbol();
  context[fnKey] = this;

  const result = argsArray ? context[fnKey](...argsArray) : context[fnKey](); // å¤„ç† `undefined`
  delete context[fnKey];

  return result;
};

// âœ… æµ‹è¯• `myApply`
greet.myApply(person, ["Hi", "."]); // Hi, Alice.
```

**bind**

```js
Function.prototype.myBind = function (context, ...args) {
  if (typeof this !== "function") {
    throw new TypeError("Not a function");
  }

  const fn = this; // ä¿ç•™åŸå‡½æ•°
  
  return function(...innerargs) {
    return fn.apply(context, [...args, ...innerArgs]);
  };
};

// âœ… æµ‹è¯• `myBind`
const boundGreet = greet.myBind(person, "Hey");
boundGreet("!!"); // Hey, Alice!!
```



### æµ…æ‹·è´å’Œæ·±æ‹·è´

- **æµ…æ‹·è´**ï¼šä»…å¤åˆ¶å¯¹è±¡çš„ç¬¬ä¸€å±‚å±æ€§ï¼ŒåµŒå¥—å¯¹è±¡ä¼šå…±äº«å¼•ç”¨ã€‚
- **æ·±æ‹·è´**ï¼šé€’å½’å¤åˆ¶å¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç¡®ä¿åµŒå¥—å¯¹è±¡ä¸å…±äº«å¼•ç”¨ã€‚

æµ…æ‹·è´åªå¤åˆ¶äº†å¯¹è±¡æˆ–æ•°ç»„çš„**ç¬¬ä¸€å±‚å±æ€§**ï¼Œå¦‚æœæŸä¸ªå±æ€§å€¼æ˜¯å¯¹è±¡æˆ–æ•°ç»„ï¼ˆå³å¼•ç”¨ç±»å‹ï¼‰ï¼Œé‚£ä¹ˆ**æµ…æ‹·è´**ä¼šå¤åˆ¶è¯¥å±æ€§çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡æˆ–æ•°ç»„ã€‚



```js
// æµ…æ‹·è´
const copy = (obj) => {
	let shallowCopy;
  // æˆ–è€…const shallowCopy = { ...obj };
  for(let key in obj){
    shallowCopy[key] = obj[key];
  }
  return shallowCopy;
}
```



**ä½¿ç”¨ JSON.parse() å’Œ JSON.stringify()**å®ç°æ·±æ‹·è´ï¼ˆé€‚ç”¨äºå¯¹è±¡ä¸­æ²¡æœ‰å‡½æ•°ã€undefined æˆ–ç‰¹æ®Šå¯¹è±¡ï¼‰ï¼š

```js
const obj = { a: 1, b: { c: 2 } };
const deepCopy = JSON.parse(JSON.stringify(obj));
deepCopy.b.c = 3;

console.log(obj.b.c);  // 2
console.log(deepCopy.b.c);  // 3
```



**ä½¿ç”¨é€’å½’å®ç°æ·±æ‹·è´**ï¼ˆé€‚ç”¨äºæ›´å¤æ‚çš„æƒ…å†µï¼‰ï¼š

```js
const deepcopy = (objs) => {
  if(objs instanceof Array){
    const mapCopy = [];
    for(let key, value of objs){
      setCopy.set(deepcopy(key), deepclone(value));
    }
  }
}
```



```js
function deepClone(value) {
  // å¦‚æœæ˜¯åŸå§‹ç±»å‹ï¼Œç›´æ¥è¿”å›
  if (value === null || typeof value !== 'object') {
    return value;
  }

  // å¤„ç† Date ç±»å‹
  if (value instanceof Date) {
    return new Date(value);
  }

  // å¤„ç† RegExp ç±»å‹
  if (value instanceof RegExp) {
    return new RegExp(value);
  }

  // å¤„ç† Map ç±»å‹
  if (value instanceof Map) {
    const mapCopy = new Map();
    value.forEach((val, key) => {
      mapCopy.set(deepClone(key), deepClone(val));
    });
    return mapCopy;
  }


  // å¤„ç† Set ç±»å‹
  if (value instanceof Set) {
    const setCopy = new Set();
    value.forEach(val => {
      setCopy.add(deepClone(val));
    });
    return setCopy;
  }

  // å¤„ç† Array ç±»å‹
  if (Array.isArray(value)) {
    return value.map((item)=>deepClone(item));
  }

  // å¤„ç†å¯¹è±¡ï¼ˆæ™®é€šå¯¹è±¡ã€å­—é¢é‡å¯¹è±¡ç­‰ï¼‰
  const objCopy = {};
  for (const key in value) {
    // è¿™ä¸€è¡Œä»£ç çš„ç›®çš„æ˜¯æ£€æŸ¥å¯¹è±¡ value æ˜¯å¦æ‹¥æœ‰å±æ€§ keyï¼Œå¹¶ä¸”è¿™ä¸ªå±æ€§ä¸æ˜¯ä»åŸå‹é“¾ä¸Šç»§æ‰¿æ¥çš„ã€‚
    if (value.hasOwnProperty(key)) {
      // åªä¼šæ‰“å° 'a' å’Œ 'b'ï¼Œä¸åŒ…æ‹¬ç»§æ‰¿çš„ 'c'
      objCopy[key] = deepClone(value[key]);
    }
  }

  return objCopy;
}

const obj = { a: 1, b: { c: 2 } };
const deepCopy = deepClone(obj);
deepCopy.b.c = 3;

console.log(obj.b.c);  // 2
console.log(deepCopy.b.c);  // 3
```



### æ•°ç»„ç›¸å…³

##### splice

spliceè¿”å›åŸæ•°ç»„

- **start**: å¿…éœ€ã€‚æŒ‡å®šä¿®æ”¹çš„èµ·å§‹ä½ç½®ï¼ˆä»ç´¢å¼• 0 å¼€å§‹ï¼‰ã€‚å¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™ä»æ•°ç»„çš„å°¾éƒ¨å¼€å§‹è®¡ç®—ä½ç½®ã€‚

- **deleteCount**: å¯é€‰ã€‚æŒ‡å®šè¦åˆ é™¤çš„å…ƒç´ æ•°é‡ã€‚å¦‚æœä¸º 0ï¼Œåˆ™ä¸ä¼šåˆ é™¤å…ƒç´ ã€‚å¦‚æœä¸æä¾›è¯¥å‚æ•°ï¼Œåˆ™ä¼šåˆ é™¤ä» start å¼€å§‹çš„æ‰€æœ‰å…ƒç´ ã€‚

- **item1, item2, ..., itemN**: å¯é€‰ã€‚è¦æ·»åŠ åˆ°æ•°ç»„ä¸­çš„å…ƒç´ ã€‚å¦‚æœæ²¡æœ‰æä¾›ï¼Œåˆ™è¡¨ç¤ºä»…åˆ é™¤å…ƒç´ ï¼Œä¸æ·»åŠ æ–°å…ƒç´ ã€‚

```js
array.splice(start, deleteCount, item1, item2, ..., itemN);
```

##### slice

slice() æ–¹æ³•ç”¨äºä»æ•°ç»„ä¸­è¿”å›ä¸€ä¸ª**æµ…æ‹·è´**çš„éƒ¨åˆ†æ–°æ•°ç»„ã€‚å®ƒä¸æ”¹å˜åŸæ•°ç»„ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚slice() å¯ä»¥ç”¨æ¥æå–æ•°ç»„çš„ä¸€éƒ¨åˆ†ï¼Œæˆ–ä»…ä»…å°†æ•´ä¸ªæ•°ç»„å¤åˆ¶ä¸€ä»½ã€‚

```js
array.slice(begin, end);
```

#### **å®ç°forEachæ–¹æ³•**

```js
Array.prototype.forEach = function(callback, context){
  let self = this,
      len = self.length;
  for(let i=0; i< len; i++){
    typeof callback === 'function' && callback.call(context??undefined, self[i], i)
  }
}
```

#### **å®ç°filteræ–¹æ³•**

```js
Array.prototype.filter = function(callback, context){
  const self = this,
        len = self.length;
  let newArray = [];
  for(let i = 0; i < len; i++){
    if(callback.apply(context??undefined, [self[i],i])){
      newArray.push(self[i]);
    }
  }
  return newArray;
}
```

#### **å®ç°findæ–¹æ³•**

```js
// find ä¼šéå†æ‰€æœ‰çš„å…ƒç´ ï¼Œæ‰§è¡Œä½ ç»™å®šçš„å¸¦æœ‰æ¡ä»¶è¿”å›å€¼çš„å‡½æ•°
Array.prototype.find = function(callback){
  const self = this,
        len = self.length;
  for(let i =0; i < len; i++){
    if (callback(self[i], i)) {
      return self[i]
      // findIndexå°±return i
    }
  }
}
```

#### **å®ç°mapæ–¹æ³•**

```js
Array.prototype.map = function(callback, context){
  // mapä¸æ”¹å˜åŸæ•°ç»„ è¿”å›æ–°æ•°ç»„
  const arr = [...Array],
        len = self.length;
  let res = [];
  for(let i =0; i < len; i++){
    res.push(callback.call(context??undefined, arr[i], i));
  }
  return res;
}
```

#### **å®ç°reduceæ–¹æ³•**

```js
Array.prototype.reduce = function(callback, initialValue){
	const self = this,
        arr = [...self],
        len = self.length;
  res = initialValue ? initialValue : 0; // ä¸ä¼ é»˜è®¤å–æ•°ç»„ç¬¬ä¸€é¡¹
  startIndex = 0;
  for(let i = 0; i < len; i++){
    res = callback.call(undefined, res, arr[i], i, arr);
  }
  return res;
}
```

#### **å®ç°everyæ–¹æ³•**

```js
Array.prototype.every = function(callback, context){
	const self = this,
        arr = [...self],
				len = self.length;
	for(let i = 0; i< len; i++){
		 if(!callback.call(context, arr[i], i, arr)){
		 		return false;
		 }
	}
  return true;
}
```

#### **å®ç°someæ–¹æ³•**

```js
Array.prototype.some = function(callback, context){
  const self = this,
        arr = [...self],
        len = self.length;
  for(let i = 0; i < len; i++){
    if(callback.call(context??undefined, arr[i], i, arr)){
      return true;
    }
  }
  return false;
}
```

#### **å®ç°Array.of**

```js
Array.of = function(arg){
	return [].slice.call(arg);
}
```

#### å®ç°æ•°ç»„æ‰å¹³åŒ–flat

1. ```js
   arr_flat = arr.flat(Infinity);
   ```

2. ```js
   // é€’å½’çš„ä¸€ç§ reduceå®ç°
   // å¦‚æœ cur æ˜¯æ•°ç»„ï¼Œå°±é€’å½’è°ƒç”¨ flatten(cur)ï¼Œå¦åˆ™ç›´æ¥æ·»åŠ åˆ° acc é‡Œã€‚
   const flatten = function(arr){
   	return arr.reduce((acc,curr) => {
   		return arr.concat(Array.isArray(cur) ? flatten(cur) : cur);
   	},[])
   }
   ```

3. ```js
   // spliteåˆ†å‰²åä»¥æ•°ç»„è¿”å›
   ary = str.replace(/(\[|\])/g, '').split(',');
   ```

4. ```js
   str = str.replace(/(\[\]))/g, '');
   str = '[' + str + ']';
   // JSON.parse()å°† JSON å­—ç¬¦ä¸²è§£æä¸º JavaScript å¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ã€‚
   ary = JSON.parse(str);
   ```

5. ```js
   // è¿­ä»£ æ¯æ¬¡å±•å¼€ä¸€å±‚
   function flatten(arr) {
     if (!arr.length) return;
     while (arr.some((item) => Array.isArray(item))) {
       arr = [].concat(...arr);
     }
     return arr;
   }
   ```

#### å®ç°Array.isArrayæ–¹æ³•

```js
Array.isArray = function(value){
	return Object.prototype.toString.call(value) === '[object Array]'
} 
```



#### æ•°ç»„å»é‡

1. ```js
   // ç”¨set ES6æ–°çš„
   const arr = [1, 2, 2, 3, 4, 4, 5];
   const uniqueArr = [...new Set(arr)];
   ```

2. ```js
   // ä½¿ç”¨filterè¿‡æ»¤
   const arr = [1, 2, 2, 3, 4, 4, 5];
   // åˆ¤æ–­å½“å‰å…ƒç´ çš„ç¬¬ä¸€ä¸ªå‡ºç°ä½ç½®æ˜¯å¦ç­‰äºå½“å‰ç´¢å¼•ï¼Œå¦‚æœæ˜¯ï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°ï¼Œå› æ­¤ä¿ç•™è¯¥å…ƒç´ 
   // filter() æ–¹æ³•åˆ›å»ºç»™å®šæ•°ç»„ä¸€éƒ¨åˆ†çš„æµ…æ‹·è´ï¼Œå…¶åŒ…å«é€šè¿‡æ‰€æä¾›å‡½æ•°å®ç°çš„æµ‹è¯•çš„æ‰€æœ‰å…ƒç´ ã€‚
   const uniqueArr = arr.filter((value, index, self) => {
     // åˆ¤æ–­å½“å‰å…ƒç´ åœ¨æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå‡ºç°ä½ç½®æ˜¯å¦ç­‰äºå½“å‰ç´¢å¼•
     return self.indexOf(value) === index;
   });
   ```
   
4. ```js
   // reduceæ–¹æ³•å®ç°
   function uniqueArray(arr) {
     return arr.reduce((accumulator, currentValue) => {
       // åˆ¤æ–­å½“å‰å€¼æ˜¯å¦å·²ç»å­˜åœ¨äºç»“æœæ•°ç»„ä¸­
       if (!accumulator.includes(currentValue)) {
         accumulator.push(currentValue);  // å¦‚æœæ²¡æœ‰ï¼ŒåŠ å…¥ç»“æœæ•°ç»„
       }
       return accumulator;
     }, []);  // åˆå§‹å€¼æ˜¯ä¸€ä¸ªç©ºæ•°ç»„
   }
   ```

#### ç±»æ•°ç»„è½¬æ•°ç»„çš„æ–¹æ³•

```js
const arrayLike=document.querySelectorAll('div')

// 1.æ‰©å±•è¿ç®—ç¬¦
[...arrayLike]
// 2.Array.from
Array.from(arrayLike)
// 3.Array.prototype.slice
Array.prototype.slice.call(arrayLike)
// 4.Array.apply
Array.apply(null, arrayLike)
// 5.Array.prototype.concat
Array.prototype.concat.apply([], arrayLike)

```



#### æ•°ç»„ä¹±åº - éšæœºæ‰“ä¹±æ•°ç»„é¡ºåº

**Fisher-Yates æ´—ç‰Œ**

```js
function shuffle(arr){
  let n = arr.length;
  for(let i = n-1; i > 0;i--){
    let j = Math.floor(Math.random() * (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
```

**Array.prototype.sort() æ–¹æ³•**

```js
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
```



### è®¾è®¡æ¨¡å¼

#### å‘å¸ƒè®¢é˜…æ¨¡å¼

å‘å¸ƒ-è®¢é˜…æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œå…è®¸å¯¹è±¡ä¹‹é—´è¿›è¡Œ**è§£è€¦çš„é€šä¿¡**ã€‚

```js
class PubSub {
    constructor() {
        this.subscribers = new Map(); // ä½¿ç”¨ Map å­˜å‚¨è®¢é˜…è€…
    }

    // è®¢é˜…æ–¹æ³•
    subscribe(event, callback) {
        if (!this.subscribers.has(event)) {
            this.subscribers.set(event, []); // å¦‚æœæ²¡æœ‰è¯¥äº‹ä»¶çš„è®¢é˜…è€…ï¼Œåˆ™åˆå§‹åŒ–
        }
        this.subscribers.get(event).push(callback); // æ·»åŠ è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
    }

    // å‘å¸ƒæ–¹æ³•
    publish(event, data) {
        if (this.subscribers.has(event)) {
            this.subscribers.get(event).forEach(callback => {
                callback(data); // è°ƒç”¨æ¯ä¸ªè®¢é˜…è€…çš„å›è°ƒå‡½æ•°
            });
        }
    }

    // å–æ¶ˆè®¢é˜…æ–¹æ³•
    unsubscribe(event, callback) {
        if (this.subscribers.has(event)) {
            const callbacks = this.subscribers.get(event);
            this.subscribers.set(event, callbacks.filter(subscriber => subscriber !== callback)); // ç§»é™¤æŒ‡å®šçš„å›è°ƒå‡½æ•°
        }
    }
}
```

**æµ‹è¯•ç”¨ä¾‹**

```js
// subscriber.js - è®¢é˜…è€…
import { pubSub } from "./pubsub.js";

function handleMessage(data) {
    console.log("æ”¶åˆ°æ¶ˆæ¯:", data);
}

// è®¢é˜… "message" äº‹ä»¶
pubSub.on("message", handleMessage);
```



```js
// subscriber.js - è®¢é˜…è€…
import { pubSub } from "./pubsub.js";

function handleMessage(data) {
    console.log("æ”¶åˆ°æ¶ˆæ¯:", data);
}

// è®¢é˜… "message" äº‹ä»¶
pubSub.on("message", handleMessage);

```



#### è§‚å¯Ÿè€…æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œ**å®ƒå…è®¸å¯¹è±¡ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ç»´æŠ¤ä¸€ç»„ä¾èµ–è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼Œå¹¶åœ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…**ã€‚

å‘å¸ƒè®¢é˜…æ¨¡å¼ç®¡ç†äº‹ä»¶çš„å›è°ƒé˜Ÿåˆ—ï¼Œè§‚å¯Ÿè€…æ¨¡å¼ç®¡ç†è§‚å¯Ÿè€…

```javascript
// è¢«è§‚å¯Ÿè€…
Class Subject{
  constructor(){
    this.observer = new Set();// è§‚å¯Ÿè€…åˆ—è¡¨
  }
  addObserver(observer){
    this.observer.push(observer);
  }
  removeObserver(observer){
    this.observers = this.observers.filter(obs => obs !== observer);
  }
  // é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…
  notify(data){
    this.observer.forEach(observer=>observer.update(data));
  }
}

// å¯¼å‡ºå…¨å±€å®ä¾‹ï¼Œä¿è¯ä¸åŒæ–‡ä»¶ä½¿ç”¨åŒä¸€ä¸ª Subject
export const subject = new Subject();
```

```js
// observerA.js - è§‚å¯Ÿè€… A
import { subject } from "./subject.js";

const observerA = {
    update: (data) => console.log("ğŸ‘€ è§‚å¯Ÿè€… A æ”¶åˆ°æ•°æ®:", data)
};

// æ³¨å†Œè§‚å¯Ÿè€… A
subject.addObserver(observerA);
```

#### å•ä¾‹æ¨¡å¼

```js
// singleton.js
class Singleton {
    constructor() {
        if (!Singleton.instance) {
            Singleton.instance = this;
        }
        return Singleton.instance;
    }
}

export default new Singleton(); // ç›´æ¥å¯¼å‡ºå”¯ä¸€å®ä¾‹
```

### æ’åºç®—æ³•

1. å†’æ³¡ä¼ æœ€å¤§
2. é€‰æ‹©æ’åºé€æ¸æ‰¾æœ€å°çš„
3. æ’å…¥æ’åº é€ä¸ªå‘é‡Œæ’
4. å½’å¹¶æ’åº åˆ†æˆå­åºåˆ—

#### å†’æ³¡æ’åº Bubble sort

æ—¶é—´å¤æ‚åº¦O(n^2)

```js
const bubble = function(array){
  const len = array.length;
  for(let i = 0; i < len - 1; i++){
    let sawp = false;
    for (let j = 0; j < len - 1 - i; j++) {
      if(array[j] > array[j+1]){
        [array[j], array[j+1]] = [array[j+1], array[j]];
        swap = true;
      }
      if(swap === false){
        return array;
      }
    }
  }
}
```



#### é€‰æ‹©æ’åº selection sort

æ—¶é—´å¤æ‚åº¦O(n^2)

```js
const select = function(array){
  const len = array.length;
  for(let i = 0; i < len; i++){
    let minIndex = i;
    for(let j = i+1; j < len; j++){
      if(array[j] < array[minIndex]){
        minIndex = j;
      }
    }
    if(minIndex !== i){
      [array[i], array[minIndex]] = [array[minIndex], array[i]];
    }
  }
  return array;
}
```



#### æ’å…¥æ’åº insertion sort

æ—¶é—´å¤æ‚åº¦O(n^2)

```js
const insert = function(array){
  const len = array.length;
  for(let i = 1; i < len; i++){
    let key = arr[i];
    let j = i - 1;
    while(j >= 0 && key < array[j]){
      // å³ç§»
      array[j + 1] = array[j];
      j--;
    }
    array[j+1] = key;
  }
  return array;
}
```



#### å½’å¹¶æ’åº merge sort

æ—¶é—´å¤æ‚åº¦O(n log n)

```js
const mergeSort = function(arr){
  if(arr.length <= 1){
    return arr;
  }
  
  const merge = (left, right) => {
    let result = [], i = 0, j = 0;
    while(i < left.length && j < right.length){
      result.push(left[i] < right[j] ? left[i++] : right[j++]);
    }
    return result.concat(left[i], right[j]);
  }
  
  let mid = Math.floor(arr.length / 2);
  // sliceåŒ…å«å·¦ä¾§ä¸åŒ…å«å³ä¾§
  let left = mergeSort(arr.slice(0, mid));
  let right = mergeSort(arr.slice(mid));
  
  return merge(left, right);
}
```



#### å¿«é€Ÿæ’åº quick sort

å¿«é€Ÿæ’åºï¼ˆQuick Sortï¼‰æ˜¯ä¸€ç§ **åˆ†æ²»æ³•**ï¼ˆDivide and Conquerï¼‰æ’åºç®—æ³•ï¼Œå®ƒé€šè¿‡é€‰å–ä¸€ä¸ªâ€œåŸºå‡†å…ƒç´ â€ï¼ˆpivotï¼‰ï¼Œç„¶åå°†æ•°ç»„åˆ†æˆä¸¤ä¸ªå­æ•°ç»„ï¼Œä½¿å¾—å·¦å­æ•°ç»„çš„æ‰€æœ‰å…ƒç´ éƒ½å°äºç­‰äºåŸºå‡†å…ƒç´ ï¼Œå³å­æ•°ç»„çš„æ‰€æœ‰å…ƒç´ éƒ½å¤§äºç­‰äºåŸºå‡†å…ƒç´ 

æ—¶é—´å¤æ‚åº¦ï¼šO(n log n)ï¼Œä½†æœ€åæƒ…å†µä¸‹ O(nÂ²)

```js
const quick = function(arr){
  if (arr.length <= 1) return arr;
  
  let pivot = arr[Math.floor(arr.length / 2)];
  let left = arr.filter(x => x < pivot);
  let middle = arr.filter(x => x === pivot);
  let right = arr.filter(x => x > pivot);
  
  
  return quick(left).concat(middle, quick(right));
}
```



#### éšæœºå¿«é€Ÿæ’åº

å’Œå¿«æ’ç›¸æ¯”ï¼Œéšæœºæ‰¾ä¸€ä¸ªåŸºå‡†æ•°

```js
const quick = function(arr){
  if (arr.length <= 1) return arr;
  const len = arr.length;
  let pivot = arr[Math.floor(Math.random() * (len+1))];
  let left = arr.filter(x => x < pivot);
  let middle = arr.filter(x => x === pivot);
  let right = arr.filter(x => x > pivot);
  
  return quick(left).concat(middle, quick(right));
}
```



#### è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰

```js
function countingSort(arr) {
    if (arr.length === 0) return []; // ç©ºæ•°ç»„ç›´æ¥è¿”å›

    // 1. æ‰¾åˆ°æ•°ç»„ä¸­çš„æœ€å¤§å€¼å’Œæœ€å°å€¼
    const max = Math.max(...arr);
    const min = Math.min(...arr);

    // 2. åˆ›å»ºè®¡æ•°æ•°ç»„ï¼Œå¹¶åˆå§‹åŒ–ä¸º0
    const range = max - min + 1; // èŒƒå›´
    const count = new Array(range).fill(0);

    // 3. ç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„é¢‘ç‡
    for (let num of arr) {
        count[num - min]++;
    }
    // 4. ç´¯ç§¯è®¡æ•°æ•°ç»„
    for (let i = 1; i < count.length; i++) {
        count[i] += count[i - 1];
    }
    // 5. æ„å»ºæ’åºåçš„æ•°ç»„
    const sortedArr = new Array(arr.length);
    for (let i = arr.length - 1; i >= 0; i--) {
        const num = arr[i];
        const index = count[num - min] - 1;
        sortedArr[index] = num;
        count[num - min]--; // æ›´æ–°è®¡æ•°æ•°ç»„
    }

    return sortedArr;
}
```



#### åŸºæ•°æ’åº







#### ä½å›¾æ’åº Bitmap Sort



### å‡½æ•°çš„æŸ¯é‡ŒåŒ–currying

**æŸ¯é‡ŒåŒ–**æ˜¯ä¸€ç§å°†æ¥æ”¶å¤šä¸ªå‚æ•°çš„å‡½æ•°è½¬æ¢æˆä¸€ç³»åˆ—æ¥æ”¶å•ä¸€å‚æ•°çš„å‡½æ•°çš„æŠ€æœ¯ã€‚é€šè¿‡æŸ¯é‡ŒåŒ–ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå¤šå‚æ•°å‡½æ•°è½¬åŒ–ä¸ºä¸€ç³»åˆ—å¯ä»¥é€ä¸ªæ¥æ”¶å•ä¸€å‚æ•°å¹¶è¿”å›æ–°å‡½æ•°çš„å‡½æ•°ã€‚

æ¥æ”¶ä¸€éƒ¨åˆ†å‚æ•°ï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°æ¥æ”¶å‰©ä½™å‚æ•°ï¼Œæ¥æ”¶è¶³å¤Ÿå‚æ•°åï¼Œæ‰§è¡ŒåŸå‡½æ•°

æŸ¯é‡ŒåŒ–çš„ä¼˜åŠ¿

- **éƒ¨åˆ†åº”ç”¨**ï¼šå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°å¹¶æä¾›ä¸€éƒ¨åˆ†å‚æ•°ï¼Œç¨åå†æä¾›å‰©ä¸‹çš„å‚æ•°ã€‚

- **å»¶è¿Ÿè®¡ç®—**ï¼šé€šè¿‡é€æ­¥ä¼ é€’å‚æ•°ï¼Œå¯ä»¥å®ç°å‡½æ•°è°ƒç”¨çš„å»¶è¿Ÿæ‰§è¡Œã€‚

- **æé«˜å‡½æ•°å¤ç”¨æ€§**ï¼šå½“æŸäº›å‚æ•°å·²çŸ¥æ—¶ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¹¶å¤ç”¨å®ƒã€‚

å‚æ•°å¤ç”¨`ã€`æå‰è¿”å›`å’Œ`å»¶è¿Ÿæ‰§è¡Œ

```js
// curry(fn)ï¼šæ¥å—ä¸€ä¸ªå‡½æ•° fnï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ã€‚
function curry(fn){
  // fnçš„å‚æ•°é•¿åº¦
  const fnArgsLen = fn.length;
  let args = [];
  return function calc(...newArgs){
    args = [
      			...args,
            ...newArgs
           ]
    // ç§¯ç´¯çš„å‚æ•°é•¿åº¦è·Ÿä¼ å…¥å‡½æ•°çš„å‚æ•°é•¿åº¦å¯¹æ¯”
    if(args.length < fnArgsLen){
      // å‚æ•°ä¸å¤Ÿï¼Œè¿”å›å‡½æ•° ç»§ç»­æ¥æ”¶å‚æ•°
      return calc;
    } else {
       // ä¼ å…¥è¶…è¿‡fnArgsLengthé•¿åº¦çš„å‚æ•°æ²¡æœ‰æ„ä¹‰
      fn.apply(this, args.slice(0, fnArgsLen))
    }
  }
}
```

æµ‹è¯•

```js
const multiply = (a, b, c, d) => a * b * c * d;
const curriedMultiply = curry(multiply);

console.log(curriedMultiply(2)(3)(4)(5)); // 120
```



### å­—ç¬¦ä¸²ç›¸å…³

Replace å‚æ•°ï¼š

1. **$0ï¼ˆæˆ– matchï¼‰**ï¼šå®Œæ•´åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚
2. **$1, $2, ...**ï¼šä»£è¡¨æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„**æ•è·ç»„**ï¼ˆ() å†…çš„éƒ¨åˆ†ï¼‰ã€‚

#### æŸ¥æ‰¾å‡ºç°æœ€å¤šçš„å­—ç¬¦å’Œæ•°å­—

```js
let str = "abcabcabcbbccccc";
let num = 0;
let char = '';

 // ä½¿å…¶æŒ‰ç…§ä¸€å®šçš„æ¬¡åºæ’åˆ—
str = str.split('').sort().join('');
// "aaabbbbbcccccccc"

// å®šä¹‰æ­£åˆ™è¡¨è¾¾å¼
let re = /(\w)\1+/g;
str.replace(re,($0,$1) => {
    if(num < $0.length){
        num = $0.length;
        char = $1;        
    }
});
console.log(`å­—ç¬¦æœ€å¤šçš„æ˜¯${char}ï¼Œå‡ºç°äº†${num}æ¬¡`);

```



#### å­—ç¬¦ä¸²æŸ¥æ‰¾

```js
function isContain(a, b) {
  for (let i = 0; i < b.length; i++) {
    if (a[0] === b[i]) {
      let tmp = true;
      for (let j = 0; j < a.length; j++) {
        if (a[j] !== b[i + j]) { // ç›´æ¥ç”¨ i + j
          tmp = false;
          break;
        }
      }
      if (tmp) return i;
    }
  }
  return -1;
}
```



### è¿­ä»£å™¨å’Œç”Ÿæˆå™¨ Iterator&&Generator

åœ¨ JavaScript ä¸­,ç”Ÿæˆå™¨(Generator)å’Œè¿­ä»£å™¨(Iterator)æ˜¯ä¸¤ä¸ªç›¸å…³çš„æ¦‚å¿µ,å®ƒä»¬å…±åŒæ„æˆäº†ä¸€ç§å¼ºå¤§çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹

**è¿­ä»£å™¨** é€‚åˆ**éå†æ•°æ®ç»“æ„**ï¼Œè€Œ **ç”Ÿæˆå™¨** é€‚åˆ**æ§åˆ¶æµç¨‹ï¼ˆå¼‚æ­¥/åŠ¨ç”»/æ‡’åŠ è½½ï¼‰**ï¼Œåœ¨å‰ç«¯å¼€å‘ä¸­èƒ½æå¤§ä¼˜åŒ–**æ€§èƒ½**å’Œ**ä»£ç å¯è¯»æ€§**ï¼

#### è¿­ä»£å™¨

è¿­ä»£å™¨å°±æ˜¯ä¸€ä¸ª**èƒ½è®°ä½å½“å‰è¿›åº¦**ï¼Œå¹¶ä¸”**æŒ‰éœ€æä¾›**æ•°æ®çš„å¯¹è±¡ã€‚

è°ƒç”¨è¿­ä»£å™¨è·å¾—è¿­ä»£å¯¹è±¡ï¼Œé‡å¤è°ƒç”¨è¿­ä»£å¯¹è±¡çš„nextæ–¹æ³•ï¼Œç›´åˆ°è¿”å›çš„doneä¸ºtrue

- è¿­ä»£å™¨æ˜¯ä¸€ç§æ¥å£,å®šä¹‰äº†ä¸€ä¸ªç»Ÿä¸€çš„éå†æœºåˆ¶ã€‚
- ä»»ä½•å®ç°äº† `next()` æ–¹æ³•çš„å¯¹è±¡éƒ½å¯ä»¥ç§°ä¸ºè¿­ä»£å™¨ã€‚
- `next()` æ–¹æ³•è¿”å›ä¸€ä¸ªåŒ…å« `value` å’Œ `done` å±æ€§çš„å¯¹è±¡,è¡¨ç¤ºå½“å‰éå†çš„å€¼å’Œæ˜¯å¦éå†ç»“æŸã€‚

```js
function createIterator(arr) {
  let index = 0;
  return {
    next() {
      if (index < arr.length) {
        return { value: arr[index++], done: false };  // å–å½“å‰å…ƒç´ 
      } else {
        return { value: undefined, done: true };  // æ²¡äº†
      }
    },
  };
}

// è¯•è¯•çœ‹
const it = createIterator(["ğŸ•", "ğŸ”", "ğŸŸ"]);
console.log(it.next()); // { value: "ğŸ•", done: false }
console.log(it.next()); // { value: "ğŸ”", done: false }
console.log(it.next()); // { value: "ğŸŸ", done: false }
console.log(it.next()); // { value: undefined, done: true }
```



#### ç”Ÿæˆå™¨

ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ª**å¯ä»¥æš‚åœçš„å‡½æ•°**ï¼Œä½ è°ƒç”¨å®ƒæ—¶ï¼Œå®ƒ**ä¸ä¼šä¸€æ¬¡æ€§è·‘å®Œ**ï¼Œè€Œæ˜¯**ä¸€æ­¥ä¸€æ­¥æ‰§è¡Œ**ï¼Œæ¯æ¬¡ yield æš‚åœï¼Œç­‰ä½ ä¸‹æ¬¡å«å®ƒï¼Œå®ƒæ‰ç»§ç»­è·‘ã€‚

ç”Ÿæˆå™¨å‡½æ•°çš„åº•å±‚å®ç°æ¶‰åŠåˆ°**çŠ¶æ€æœº**çš„æ¦‚å¿µã€‚æ¯æ¬¡è°ƒç”¨ yield æ—¶ï¼Œ**å‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«ä¿å­˜**ï¼Œå¹¶åœ¨ä¸‹æ¬¡è°ƒç”¨ next() æ—¶æ¢å¤ã€‚**ä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°è¯­æ³•**

1. **çŠ¶æ€ç®¡ç†**ï¼š
   - suspendedï¼ˆæš‚åœï¼‰ï¼šåˆå§‹çŠ¶æ€æˆ–é‡åˆ° yield æ—¶
   - nativeï¼ˆæ‰§è¡Œï¼‰ï¼šè°ƒç”¨ next() åå¼€å§‹æ‰§è¡Œ
   - closedï¼ˆå…³é—­ï¼‰ï¼šæ‰§è¡Œå®Œæ¯•æˆ–è¢«æå‰ç»ˆæ­¢
2. **æ‰§è¡Œæ§åˆ¶**ï¼š
   - `next()`ï¼šç»§ç»­æ‰§è¡Œç›´åˆ°ä¸‹ä¸€ä¸ª yield
   - `return()`ï¼šæå‰ç»“æŸç”Ÿæˆå™¨
   - `throw()`ï¼šå‘ç”Ÿæˆå™¨å†…éƒ¨æŠ›å‡ºé”™è¯¯

- æ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨å‡½æ•°,éƒ½ä¼šè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡,è¯¥å¯¹è±¡å®ç°äº†è¿­ä»£å™¨æ¥å£ã€‚

  ```js
  // ç”Ÿæˆå™¨å‡½æ•°çš„ç®€åŒ–åº•å±‚å®ç°åŸç†
  function generatorFunction() {
      let state = 0;
      const context = {
          next() {
              switch (state) {
                  case 0:
                      state = 1;
                      return { value: 1, done: false };
                  case 1:
                      state = 2;
                      return { value: 2, done: false };
                  case 2:
                      state = 3;
                      return { value: 3, done: false };
                  case 3:
                      return { value: undefined, done: true };
              }
          }
      };
      return context;
  }
  ```

1. ç”Ÿæˆå™¨ç”¨ function* å®šä¹‰ï¼Œé‡Œé¢ç”¨ yield äº§å‡ºå€¼ã€‚
2. next() åªè·‘åˆ° yieldï¼Œç­‰ä¸‹ä¸€æ¬¡ next() æ‰ç»§ç»­ã€‚
3. ç›´åˆ° done: trueï¼Œè¡¨ç¤ºæ²¡æœ‰äº†ã€‚

```js
function* infiniteNumbers() {
  let num = 1;
  while (true) {
    yield num++; // ä¸€ç›´äº§ç”Ÿæ•°å­—
  }
}

const numGen = infiniteNumbers();
console.log(numGen.next().value); // 1
console.log(numGen.next().value); // 2
console.log(numGen.next().value); // 3
```

**æ¨¡æ‹Ÿå¼‚æ­¥ä»»åŠ¡**ï¼Œæ¯”å¦‚**å…ˆç­‰APIæ•°æ®è¿”å›ï¼Œå†å¤„ç†æ•°æ®**ï¼š

```js
function* asyncTask() {
  console.log("å¼€å§‹è¯·æ±‚æ•°æ®...");
  const data = yield fetch("https://jsonplaceholder.typicode.com/todos/1")
    .then(res => res.json());
  console.log("æ•°æ®æ¥äº†ï¼š", data);
}

const gen = asyncTask();
const { value } = gen.next(); // å…ˆæ‰§è¡Œç¬¬ä¸€æ­¥

value.then(data => gen.next(data)); // æ•°æ®è¿”å›åç»§ç»­
```

**async/await å®é™…ä¸Šæ˜¯ç”Ÿæˆå™¨å’Œ Promise çš„è¯­æ³•ç³–**

åŸç† - ç®€åŒ–ç‰ˆ

```js
// è¿™æ˜¯å®ƒçš„åº•å±‚å®ç°åŸç†ï¼ˆç®€åŒ–ç‰ˆï¼‰
function fetchUserData() {
    return spawn(function* () {
        try {
            const response = yield fetch('https://api.example.com/user');
            const data = yield response.json();
            return data;
        } catch (error) {
            console.error('Error:', error);
        }
    });
}

// å°† yield çš„å€¼è½¬æ¢ä¸º Promise
Promise.resolve(next.value)
  .then(
      v => step(() => generator.next(v)), // æˆåŠŸåˆ™ç»§ç»­æ‰§è¡Œ
      e => step(() => generator.throw(e))  // å¤±è´¥åˆ™æŠ›å‡ºé”™è¯¯
  );
```



**ä½¿ç”¨generatorå¤„ç†å¤§é‡æ•°æ®ï¼ˆæ‡’åŠ è½½&åˆ†æ‰¹æ¸²æŸ“ï¼‰**

**åœºæ™¯ï¼š** å¦‚æœä½ éœ€è¦åœ¨é¡µé¢ä¸Šæ¸²æŸ“ä¸€ä¸ª **è¶…é•¿åˆ—è¡¨ï¼ˆå¦‚ 10 ä¸‡æ¡æ•°æ®ï¼‰**ï¼Œç›´æ¥ map æ¸²æŸ“ä¼š**å¡æ­»é¡µé¢**ï¼Œè€Œ**ç”Ÿæˆå™¨**å¯ä»¥æŒ‰éœ€åŠ è½½ï¼Œæå‡æ€§èƒ½ã€‚

```js
function* loadData(data, batchSize) {
  let index = 0;
  while (index < data.length) {
    yield data.slice(index, index + batchSize); // æ¯æ¬¡è¿”å›ä¸€æ‰¹æ•°æ®
    index += batchSize;
  }
}

// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¶…é•¿æ•°ç»„
const longList = Array.from({ length: 100000 }, (_, i) => `Item ${i}`);

const generator = loadData(longList, 1000); // æ¯æ¬¡åŠ è½½ 1000 æ¡
function renderNextBatch() {
  const { value, done } = generator.next();
  if (!done) {
    console.log("åŠ è½½æ•°æ®:", value.length);
    setTimeout(renderNextBatch, 500); // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½
  }
}
renderNextBatch();
```



#### **è½®è¯¢æ•°æ®**

```js
function* pollData(interval) {
  while (true) {
    yield new Promise(resolve => {
      setTimeout(async () => {
        const res = await fetch("https://jsonplaceholder.typicode.com/todos/1").then(r => r.json());
        console.log("æ–°æ•°æ®ï¼š", res);
        resolve();
      }, interval);
    });
  }
}
const polling = pollData(2000); // 2 ç§’è¯·æ±‚ä¸€æ¬¡
function startPolling() {
  polling.next().value.then(startPolling); // é€’å½’è°ƒç”¨
}
startPolling();
```



#### å•è¯è½¬å°é©¼å³°

```js
function camel(str){
	return str
  			.toLowerCase()
  			.split(' ')
  			.map((word, index)=>{
    			return index===0 ? word :word.slice(0,1).toUpperCase()+word.slice(1);
  			})
  			.join('');
}
```



#### çº¢åŒ…éšæœºåˆ†é…ç®—æ³•å®ç°

```js
const redPocket = (totalAmount, totalPeople, minAmout = 0.01) => {
  let totalAmountCent = totalAmount*100;
  let minAmoutCent = minAmout*100;
  
  let remainAmountCent = totalAmountCent;
  let remainPeople = totalPeople;
  const res = [];
  
  while(remainPeople > 1){
    let maxAmount = Math.floor(remainAmountCent/remainPeople * 2);
    let amount = Math.floor((Math.random * (maxAmount - minAmoutCent + 1))+minAmoutCent);
    res.push(amount);
    remainAmountCent -= amount;
    remainPeople--;
  }
  
  res.push(remainAmountCent);
  return rea.map(amount => Math.round(amount)/100)
}
```



#### IntersectionObserver

```js
// ç®€å•çš„æ€§èƒ½æŒ‡æ ‡ä¸ŠæŠ¥å·¥å…·
function measureFlexElementsRender() {
  // è®°å½•å¯¼èˆªå¼€å§‹æ—¶é—´
  const startTime = performance.now();
  
  // éœ€è¦ç›‘æµ‹çš„å…ƒç´ é€‰æ‹©å™¨
  const selectors = [
    '.flex-item-1',
    '.flex-item-2',
    '.flex-item-3',
    '.flex-item-4',
    '.flex-item-5',
    '.flex-item-6',
    '.flex-item-7',
    '.flex-item-8'
  ];
  
  let renderedCount = 0;
  let firstElementTime = 0;
  
  // åˆ›å»ºè§‚å¯Ÿå™¨
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const currentTime = performance.now();
        const renderTime = currentTime - startTime;
        
        // è®°å½•ç¬¬ä¸€ä¸ªå…ƒç´ æ¸²æŸ“æ—¶é—´
        if (renderedCount === 0) {
          firstElementTime = renderTime;
          console.log(`ç¬¬ä¸€ä¸ªå…ƒç´ æ¸²æŸ“å®Œæˆæ—¶é—´: ${firstElementTime.toFixed(2)}ms`);
        }
        
        renderedCount++;
        observer.unobserve(entry.target);
        
        // æ£€æŸ¥æ˜¯å¦æ‰€æœ‰å…ƒç´ éƒ½å·²æ¸²æŸ“
        if (renderedCount === selectors.length) {
          const totalTime = performance.now() - startTime;
          console.log(`æ‰€æœ‰8ä¸ªå…ƒç´ æ¸²æŸ“å®Œæˆæ—¶é—´: ${totalTime.toFixed(2)}ms`);
          
          // ä¸ŠæŠ¥æ•°æ®
          sendReport({
            firstElementTime: firstElementTime.toFixed(2),
            totalTime: totalTime.toFixed(2)
          });
        }
      }
    });
  });
  
  // å¼€å§‹è§‚å¯Ÿå…ƒç´ 
  document.addEventListener('DOMContentLoaded', () => {
    selectors.forEach(selector => {
      const element = document.querySelector(selector);
      if (element) {
        observer.observe(element);
      }
    });
  });
  
  // ç®€å•çš„ä¸ŠæŠ¥å‡½æ•°
  function sendReport(data) {
    console.log('æ€§èƒ½æ•°æ®ä¸ŠæŠ¥:', data);
    // å®é™…é¡¹ç›®ä¸­è¿™é‡Œå¯ä»¥å‘é€åˆ°æœåŠ¡å™¨
    // fetch('https://example.com/report', {
    //   method: 'POST',
    //   body: JSON.stringify(data)
    // });
  }
}

// åˆå§‹åŒ–
measureFlexElementsRender();
```

